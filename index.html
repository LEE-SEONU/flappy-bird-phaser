<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Phaser Flappy Bird ğŸ¥</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser-ce/2.11.1/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        canvas { display: block; margin: 0 auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <script type="text/javascript">
        var game = new Phaser.Game(400, 600, Phaser.AUTO, '');

        // --- Menu State ---
        var MenuState = {
            preload: function() {
                var ts = new Date().getTime();
                game.load.image('splash', 'assets/splash.png?v=' + ts);
            },
            create: function() {
                var splash = game.add.sprite(0, 0, 'splash');
                game.input.onDown.addOnce(function() {
                    game.state.start('play');
                }, this);
            }
        };

        // --- Play State ---
        var PlayState = {
            preload: function() {
                var ts = new Date().getTime();
                // ì´ë¯¸ ê°€ê³µëœ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ë¡œë“œ
                game.load.image('bird', 'assets/bird.png?v=' + ts);
                game.load.image('pipe', 'assets/pipe.png?v=' + ts);
                game.load.image('background', 'assets/background.png?v=' + ts);
            },

            create: function() {
                this.background = game.add.tileSprite(0, 0, 400, 600, 'background');
                
                game.physics.startSystem(Phaser.Physics.ARCADE);

                this.bird = game.add.sprite(100, 245, 'bird');
                this.bird.anchor.setTo(0.5, 0.5);

                game.physics.arcade.enable(this.bird);
                this.bird.body.gravity.y = 1000;
                
                // ê´€ëŒ€í•œ ì¶©ëŒ ë²”ìœ„
                this.bird.body.setSize(30, 30, 5, 5);

                game.input.onDown.add(this.jump, this);
                var spaceKey = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
                spaceKey.onDown.add(this.jump, this);

                this.pipes = game.add.group();
                this.timer = game.time.events.loop(1500, this.addRowOfPipes, this);

                this.score = 0;
                this.labelScore = game.add.text(20, 20, "0", { font: "30px Arial", fill: "#ffffff" });
                this.isGameOver = false;
            },

            update: function() {
                if (this.isGameOver) return;

                if (this.bird.y < 0 || this.bird.y > 600) {
                    this.die();
                }

                game.physics.arcade.overlap(this.bird, this.pipes, this.die, null, this);

                this.background.tilePosition.x -= 1;
                if (this.bird.angle < 20) this.bird.angle += 1;
            },

            jump: function() {
                if (this.isGameOver) return;
                this.bird.body.velocity.y = -350;
                game.add.tween(this.bird).to({angle: -20}, 100).start();
            },

            addRowOfPipes: function() {
                if (this.isGameOver) return;
                var hole = Math.floor(Math.random() * 5) + 1;
                for (var i = 0; i < 10; i++) {
                    if (i != hole && i != hole + 1 && i != hole + 2) {
                        this.addOnePipe(400, i * 60);
                    }
                }
                this.score += 1;
                this.labelScore.text = this.score;
            },

            addOnePipe: function(x, y) {
                var pipe = game.add.sprite(x, y, 'pipe');
                this.pipes.add(pipe);
                game.physics.arcade.enable(pipe);
                pipe.body.velocity.x = -200;
                pipe.checkWorldBounds = true;
                pipe.outOfBoundsKill = true;
            },

            die: function() {
                if (this.isGameOver) return;
                this.isGameOver = true;
                game.time.events.remove(this.timer);
                this.pipes.forEach(function(p) { p.body.velocity.x = 0; }, this);

                var style = { font: "40px Arial", fill: "#ffffff", align: "center", fontWeight: "bold" };
                var text = game.add.text(game.world.centerX, game.world.centerY, "GAME OVER\nTap to Restart", style);
                text.anchor.setTo(0.5, 0.5);
                
                game.time.events.add(500, function() {
                    game.input.onDown.addOnce(function() { game.state.start('menu'); }, this);
                }, this);
            }
        };

        game.state.add('menu', MenuState);
        game.state.add('play', PlayState);
        game.state.start('menu');
    </script>
</body>
</html>
